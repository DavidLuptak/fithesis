\NeedsTeXFormat{LaTeX2e}

% Options
\DeclareOption{10pt}{\def\thesis@ptsize{0}}
\DeclareOption{11pt}{\def\thesis@ptsize{1}}
\DeclareOption{12pt}{\def\thesis@ptsize{2}}
\DeclareOption{oneside}{\@twosidefalse \@mparswitchfalse}
\DeclareOption{twoside}{\@twosidetrue  \@mparswitchtrue}
\DeclareOption{onecolumn}{\@twocolumnfalse}
\DeclareOption{twocolumn}{\@twocolumntrue}
\DeclareOption{draft}{\setlength\overfullrule{5pt}}
\DeclareOption{final}{\setlength\overfullrule{0pt}}
%% Colors
\newif\ifthesis@color\thesis@colorfalse
\let\thesis@logopath@color\thesis@logopath
\DeclareOption{color}{%
  \def\thesis@logopath@color{\thesis@logopath color}
  \thesis@colortrue}

\ExecuteOptions{12pt,oneside,final}
\ProcessOptions

% Packages
%% pridat volbu, aby slo vypnout mathpazo, zapnout lmodern, atd.
\RequirePackage{tgpagella}
\RequirePackage{mathpazo}
\RequirePackage{graphicx}
%% FIXME: pridat ifxetex apod.
\RequirePackage{cmap}
\RequirePackage[T1]{fontenc}
\RequirePackage[usenames,dvipsnames,svgnames,table]{xcolor}
\hypersetup{
  plainpages=false,          % Multiple page numbering support
  pdfpagelabels              % Generate pdf page labels
}

% Block definitions
\def\thesis@blocks@frontMatter{%
  \pagestyle{plain}
  \parindent 1.5em
  \setcounter{page}{1}
  \pagenumbering{roman}}

\def\thesis@blocks@cover{%
  \begin{alwayssingle}
  \thispagestyle{empty}
  \begin{center}
  {\sc\thesis@universityName\\\thesis@facultyName}
  \vskip 1.4em
  \includegraphics[width=40mm]{\thesis@logopath/\thesis@logo}\\[0.4in]
  \let\footnotesize\small
  \let\footnoterule\relax{}
  {\titlefont\bf\thesis@title\par\vfil}\vskip 0.8in
  {\sc \thesis@typeName}\\[0.3in]
  {\Large\bf\thesis@author}
  \par\vfill
  {\large\thesis@place, \thesis@year}
  \end{center}
  \end{alwayssingle}
  \newpage}

\def\thesis@blocks@titlePage{%
  \begin{alwayssingle}
  \thispagestyle{empty}
  \begin{center}
  {\sc\thesis@universityName\\\thesis@facultyName}
  \vskip 1.4em
  \includegraphics[width=40mm]{\thesis@logopath@color/\thesis@logo}\\[0.4in]
  \let\footnotesize\small
  \let\footnoterule\relax{}
  {\titlefont\bf\thesis@title\par\vfil}\vskip 0.8in
  {\sc \thesis@typeName}\\[0.3in]
  {\Large\bf\thesis@author}
  \par\vfill
  {\large\thesis@place, \thesis@year}
  \end{center}
  \end{alwayssingle}
  \newpage}

\def\thesis@blocks@declaration{%
    \begin{alwayssingle}%
      \chapter*{\thesis@declarationTitle}%
      \thesis@declaration%
      \vskip 2cm%
      \hfill\thesis@author%
      \par\vfill%
      \textbf{\thesis@advisorTitle:} \thesis@advisor%
      \par\vfil%
      \newpage%
    \end{alwayssingle}}

\def\thesis@blocks@thanks{%
  \begin{alwayssingle}%
    \chapter*{\thesis@thanksTitle}%
    \thesis@thanks%
    \par\vfill%
  \end{alwayssingle}%
  \newpage}

\def\thesis@blocks@abstract{%
  \begin{alwayssingle}%
    \chapter*{\thesis@abstractTitle}%
    \thesis@abstract%
    \par\vfil\null%
  \end{alwayssingle}%
  \newpage}

\def\thesis@blocks@abstractEn{%
  \ifx\thesis@abstractEn\undefined\else%
    \begin{alwayssingle}%
      \chapter*{\thesis@abstractTitle}%
      \thesis@abstractEn%
      \par\vfil\null%
    \end{alwayssingle}%
    \newpage%
  \fi}

\def\thesis@blocks@keywords{%
  \begin{alwayssingle}%
    \chapter*{\thesis@keywordsTitle}%
    \thesis@keywords%
    \par\vfill%
  \end{alwayssingle}%
  \newpage}

\def\thesis@blocks@keywordsEn{%
  \ifx\thesis@keywordsEn\undefined\else%
    \begin{alwayssingle}%
      \chapter*{\thesis@keywordsTitle}%
      \thesis@keywords%
      \par\vfill%
    \end{alwayssingle}%
    \newpage%
  \fi}

\def\thesis@blocks@mainMatter{%
  \if@twoside
    \clearpage
    \thispagestyle{empty}
    \cleardoublepage
  \else
    \clearpage
  \fi
  \setcounter{page}{1}
  \pagenumbering{arabic}
  \pagestyle{thesisheadings}
  \parindent 1.5em\relax}

% Style definitions
\setcounter{tocdepth}{4}

\input\thesis@stylepath mu/fit1\@ptsize.clo\relax

\def\ps@thesisheadings{%
\def\chaptermark##1{%
\markright{%
\ifnum\c@secnumdepth >\m@ne
\thechapter.\ %
\fi ##1}}
\let\@oddfoot\@empty
\let\@oddhead\@empty
\def\@oddhead{\vbox{\hbox to \textwidth{%
\hfil{\sc\rightmark}}\vskip 4pt\hrule}}
\if@twoside
 \def\@evenhead{\vbox{\hbox to \textwidth{%
 {\sc\rightmark}\hfil}\vskip 4pt\hrule}}
\else
 \let\@evenhead\@oddhead
\fi
\def\@oddfoot{\hfil\PageFont\thepage}
\if@twoside
 \def\@evenfoot{\PageFont\thepage\hfil}%
\else
 \let\@evenfoot\@oddfoot
\fi
\let\@mkboth\markboth
}

\renewcommand*\chapter{%
\if@twoside
 \clearpage
 \thispagestyle{empty}
 \cleardoublepage
\else
 \clearpage
\fi
\thispagestyle{plain}%
\global\@topnum\z@
\@afterindentfalse
\secdef\@chapter\@schapter}

\renewcommand*\part{%
\clearpage
\thispagestyle{empty}
\cleardoublepage
\thispagestyle{empty}%
\if@twocolumn%
 \onecolumn
 \@tempswatrue
\else
 \@tempswafalse
\fi
\hbox{}\vfil
\secdef\@part\@spart}

\def\titlefont{\fontsize\@xxvpt{30}\selectfont}

\newif\if@restonecol
\def\alwayssingle{%
  \@restonecolfalse\if@twocolumn\@restonecoltrue\onecolumn\fi}
\def\endalwayssingle{\if@restonecol\twocolumn\fi}

\renewcommand*\l@part[2]{%
  \ifnum \c@tocdepth >-2\relax
    \addpenalty{-\@highpenalty}%
    \addvspace{0.5em \@plus\p@}%
    \begingroup
      \setlength\@tempdima{3em}%
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      {\leavevmode
       \normalfont \bfseries #1\hfil \hb@xt@\@pnumwidth{\hss #2}}\par
       \nobreak
         \global\@nobreaktrue
         \everypar{\global\@nobreakfalse\everypar{}}%
    \endgroup
    \addvspace{0.2em \@plus\p@}%
  \fi}

\renewcommand*\l@chapter[2]{%
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}%
    \vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode \bfseries
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      #1\nobreak\hfil \nobreak\hb@xt@\@pnumwidth{\hss #2}\par
      \penalty\@highpenalty
    \endgroup
  \fi}

\renewcommand*\l@chapter{\@dottedtocline{1}{0em}{1.5em}}
\renewcommand*\l@section{\@dottedtocline{2}{1.5em}{2.3em}}
\renewcommand*\l@subsection{\@dottedtocline{2}{3.8em}{3.2em}}
\renewcommand*\l@subsubsection{\@dottedtocline{2}{7.0em}{3.8em}}